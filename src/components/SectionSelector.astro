---
import MenuIcon from "./icons/MenuIcon.astro";
import NavLinks from "./NavLinks.astro";
---

<script>
  const attachNavListeners = () => {
    const $nav = document.getElementById("nav");
    const $button = document.getElementById("nav-opener-button");

    if (!$nav || !$button) return;

    const open = () => {
      $nav.classList.remove("hidden", "disappear-to-left");
      $nav.classList.add("flex", "appear-from-right");
    };

    const close = () => {
      $nav.classList.remove("appear-from-right");
      void $nav.offsetWidth;
      $nav.classList.add("disappear-to-left");

      $nav.addEventListener(
        "animationend",
        () => {
          $nav.classList.remove("flex", "disappear-to-left");
          $nav.classList.add("hidden");
        },
        { once: true },
      );
    };

    $button.addEventListener("click", () => {
      const isOpen = !$nav.classList.contains("hidden");
      isOpen ? close() : open();
    });

    $nav.addEventListener("click", (event) => {
      const target = event.target as HTMLElement;
      if (target?.closest("a")) {
        close();
      }
    });
  };

  attachNavListeners();
  document.addEventListener("astro:after-swap", attachNavListeners);
</script>

<button id="nav-opener-button" class="desktop:hidden clickable">
  <MenuIcon />
</button>

<nav
  id="nav"
  class="hidden desktop:hidden flex-col items-end absolute top-[65px] right-0 w-[clamp(280px,50%,560px)] h-[100dvh] bg-light-bg border-l-highlight border-l-[1px] p-6 gap-y-2"
>
  <NavLinks />
</nav>
